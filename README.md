# SLR(1) Parser for Arithmetic Expressions

SLR(1) парсер для арифметических выражений на C++ с поддержкой приоритета операторов, ассоциативности и скобок.

## Описание

Проект реализует **синтаксический анализатор** для арифметических выражений на основе **алгоритма SLR(1)**. Парсер строит **детерминированный конечный автомат** на основе **LR(0) элементов**, вычисляет **множества следования** (FOLLOW sets) и генерирует **таблицы разбора** ACTION и GOTO.

---

## Грамматика языка
### Расширенная контекстно-свободная грамматика

Для построения SLR(1) парсера используется **расширенная грамматика** с новым стартовым символом `S'`:

0: S' → E 
1: E → E + T 
2: E → E - T 
3: E → T 
4: T → T * F 
5: T → T / F 
6: T → F 
7: F → ( E ) 
8: F → ID 
9: F → NUMBER

### Терминалы

| Токен | Значение | Код |
|-------|----------|-----|
| `ID` | Идентификатор (переменная) | 1 |
| `NUMBER` | Числовая константа | 0 |
| `+` | Сложение | 2 |
| `-` | Вычитание | 3 |
| `*` | Умножение | 4 |
| `/` | Деление | 5 |
| `(` | Левая скобка | 6 |
| `)` | Правая скобка | 7 |
| `$` | Конец ввода | 8 |

### Нетерминалы

| Символ | Описание |
|--------|----------|
| `S'` | Расширенный стартовый символ |
| `E` | Выражение |
| `T` | Терм (произведение) |
| `F` | Фактор (атомарное выражение) |

##  LR(0) Детерминированный конечный автомат

### Структура автоматов

**Детерминированный конечный автомат** (DFA) для грамматики строится на основе **множеств замыканий** (closure) LR(0) элементов. Автомат состоит из **17 состояний**, каждое из которых содержит множество элементов с точкой, указывающей текущую позицию разбора.

### Формальное определение

**LR(0) элемент** - это правило грамматики с точкой в правой части:
A → α • β

**Операция closure(I)** — замыкание множества элементов `I`:
1. Добавляем все элементы из `I`
2. Для каждого элемента `A → α • B β`, где `B` — нетерминал, добавляем все правила `B → • γ`
3. Повторяем, пока множество не перестанет расти

**Операция goto(I, X)** — переход из состояния `I` по символу `X`:
1. Сдвигаем точку вправо для всех элементов с `• X`
2. Вычисляем closure полученного множества

### Состояния автомата

| № | Элементы | Описание |
|---|----------|----------|
| 0 | `S' → • E`<br>`E → • E + T`<br>`E → • E - T`<br>`E → • T`<br>`T → • T * F`<br>`T → • T / F`<br>`T → • F`<br>`F → • ( E )`<br>`F → • ID`<br>`F → • NUMBER` | Начальное состояние |
| 1 | `S' → E •`<br>`E → E • + T`<br>`E → E • - T` | Состояние после `E` |
| 2 | `E → T •`<br>`T → T • * F`<br>`T → T • / F` | Состояние после `T` |
| 3 | `T → F •` | Состояние после `F` |
| 4 | `F → ID •` | Состояние после `ID` |
| 5 | `F → NUMBER •` | Состояние после `NUMBER` |
| 6 | `F → ( • E )`<br>`E → • E + T`<br>`E → • E - T`<br>`E → • T`<br>`T → • T * F`<br>`T → • T / F`<br>`T → • F`<br>`F → • ( E )`<br>`F → • ID`<br>`F → • NUMBER` | Состояние после `(` |
| 7 | `E → E + • T`<br>`T → • T * F`<br>`T → • T / F`<br>`T → • F`<br>`F → • ( E )`<br>`F → • ID`<br>`F → • NUMBER` | Состояние после `+` |
| 8 | `E → E - • T`<br>`T → • T * F`<br>`T → • T / F`<br>`T → • F`<br>`F → • ( E )`<br>`F → • ID`<br>`F → • NUMBER` | Состояние после `-` |
| 9 | `T → T * • F`<br>`F → • ( E )`<br>`F → • ID`<br>`F → • NUMBER` | Состояние после `*` |
| 10 | `T → T / • F`<br>`F → • ( E )`<br>`F → • ID`<br>`F → • NUMBER` | Состояние после `/` |
| 11 | `F → ( E • )`<br>`E → E • + T`<br>`E → E • - T` | Состояние после `E` внутри скобок |
| 12 | `E → E + T •`<br>`T → T • * F`<br>`T → T • / F` | Состояние после `E + T` |
| 13 | `E → E - T •`<br>`T → T • * F`<br>`T → T • / F` | Состояние после `E - T` |
| 14 | `T → T * F •` | Состояние после `T * F` |
| 15 | `T → T / F •` | Состояние после `T / F` |
| 16 | `F → ( E ) •` | Состояние после `)` |

##  Таблицы парсинга SLR(1)

### Структура таблиц

**Таблица ACTION** определяет действие парсера для каждой пары (состояние, терминал):
- `SHIFT N` — сдвиг в состояние N
- `REDUCE r` — свёртка по правилу №r
- `ACCEPT` — успешное завершение
- `ERROR` — ошибка

**Таблица GOTO** определяет переход по нетерминалу:
- `GOTO[i][A] = j` — переход из состояния i в состояние j по нетерминалу A

### Таблица ACTION (сокращённая)

| Состояние | ID | NUMBER | + | - | * | / | ( | ) | $ | Действие |
|-----------|----|--------|---|---|---|---|---|---|---|----------|
| 0 | S4 | S5 | | | | | S6 | | | Сдвиг в 4, 5, 6 |
| 1 | | | S7 | S8 | | | | | A | Сдвиг в 7, 8; акцептация |
| 2 | | | R3 | R3 | S9 | S10 | | R3 | R3 | Свёртка 3 на +, -, ), $ |
| 3 | | | R6 | R6 | R6 | R6 | | R6 | R6 | Свёртка 6 |
| 4 | | | R8 | R8 | R8 | R8 | | R8 | R8 | Свёртка 8 |
| 5 | | | R9 | R9 | R9 | R9 | | R9 | R9 | Свёртка 9 |
| 6 | S4 | S5 | | | | | S6 | | | Сдвиг в 4, 5, 6 |
| 7 | S4 | S5 | | | | | S6 | | | Сдвиг в 4, 5, 6 |
| 8 | S4 | S5 | | | | | S6 | | | Сдвиг в 4, 5, 6 |
| 9 | S4 | S5 | | | | | S6 | | | Сдвиг в 4, 5, 6 |
| 10 | S4 | S5 | | | | | S6 | | | Сдвиг в 4, 5, 6 |
| 11 | | | S7 | S8 | | | | S16 | | Сдвиг в 7, 8, 16 |
| 12 | | | R1 | R1 | S9 | S10 | | R1 | R1 | Свёртка 1 на +, -, ), $ |
| 13 | | | R2 | R2 | S9 | S10 | | R2 | R2 | Свёртка 2 на +, -, ), $ |
| 14 | | | R4 | R4 | R4 | R4 | | R4 | R4 | Свёртка 4 |
| 15 | | | R5 | R5 | R5 | R5 | | R5 | R5 | Свёртка 5 |
| 16 | | | R7 | R7 | R7 | R7 | | R7 | R7 | Свёртка 7 |

**Обозначения:**
- `Sn` = SHIFT n
- `Rn` = REDUCE n
- `A` = ACCEPT

### Таблица GOTO (сокращённая)

| Состояние | E | T | F |
|-----------|---|---|---|
| 0 | 1 | 2 | 3 |
| 6 | 11 | 2 | 3 |
| 7 | | 12 | 3 |
| 8 | | 13 | 3 |
| 9 | | | 14 |
| 10 | | | 15 |

### Пример использования таблиц

**Вход:** `a + b * c`

| Шаг | Стек | Вход | Действие | Пояснение |
|-----|------|------|----------|-----------|
| 1 | `$` | `ID + ID * ID $` | SHIFT 4 | `ID` распознан |
| 2 | `$4` | `+ ID * ID $` | REDUCE 8 | `F → ID` |
| 3 | `$3` | `+ ID * ID $` | REDUCE 6 | `T → F` |
| 4 | `$2` | `+ ID * ID $` | REDUCE 3 | `E → T` |
| 5 | `$1` | `+ ID * ID $` | SHIFT 7 | `+` распознан |
| 6 | `$1+7` | `ID * ID $` | SHIFT 4 | `ID` распознан |
| 7 | `$1+7 4` | `* ID $` | REDUCE 8 | `F → ID` |
| 8 | `$1+7 3` | `* ID $` | REDUCE 6 | `T → F` |
| 9 | `$1+7 2` | `* ID $` | SHIFT 9 | `*` распознан |
| 10 | `$1+7 2*9` | `ID $` | SHIFT 4 | `ID` распознан |
| 11 | `$1+7 2*9 4` | `$` | REDUCE 8 | `F → ID` |
| 12 | `$1+7 2*9 3` | `$` | REDUCE 4 | `T → T * F` |
| 13 | `$1+7 2` | `$` | REDUCE 1 | `E → E + T` |
| 14 | `$1` | `$` | ACCEPT | Успешное завершение |

## Структура проекта

```
SLR-parser/
├── src/                      # Исходные файлы
│   ├── main.cpp              # Главная функция
│   ├── parser.cpp            # Алгоритм парсинга
│   ├── lr0.cpp               # Построение LR(0) автомата
│   ├── action_table.cpp      # Таблица ACTION
│   ├── goto_table.cpp        # Таблица GOTO
│   ├── follow.cpp            # Множества FOLLOW
│   ├── token.cpp             # Преобразование токенов
│   ├── lexer.cpp             # Обёртка лексера
│   └── lexer.l               # Правила лексера (Flex)
│
├── include/                   # Заголовочные файлы
│   ├── grammar.h              # Арифметическая грамматика
│   ├── lr0.h                  # LR(0)-элементы и состояния
│   ├── table.h                # Таблицы ACTION и GOTO
│   ├── follow.h               # Множества FOLLOW
│   ├── token.h                # Токены и tokenToString
│   ├── token_types.h          # Перечисление терминалов
│   └── parser.h               # Интерфейс парсера
│
├── CMakeLists.txt             # Конфигурация CMake
└── README.md                  # Этот файл
```

## Требования
CMake 3.10 или выше
C++17 компилятор (g++, clang++)
Flex (Fast Lexical Analyzer Generator)

## Сборка

``` bash
# Создаём директорию сборки
mkdir build && cd build

# Генерируем файлы сборки
cmake ..

# Собираем проект
make

```

## Использование
### Запуск
``` bash
./slr_parser
```

### Ввод выражения
После запуска программа запросит ввод:
```
Enter arithmetic expression (e.g., a+b*c): 
```

### Формат вывода 
Программа выводит таблицу шагов разбора:
STACK   INPUT   ACTION
$       ID+ID$  Shift 4
$ID     +ID$    Reduce F->ID
$F      +ID$    Reduce T->F
$T      +ID$    Reduce E->T
$E      +ID$    Shift 8
где:
- STACK - текущее состояние стека символов
- INPUT — оставшийся входной поток
- ACTION — выполняемое действие